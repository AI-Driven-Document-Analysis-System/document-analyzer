<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RAG Chatbot with Improved Sidebar</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3b82f6',
                        secondary: '#64748b',
                        accent: '#10b981',
                        background: '#f8fafc',
                        sidebar: '#ffffff',
                    }
                }
            }
        }
    </script>
    <style>
        .sidebar-section {
            transition: all 0.3s ease;
        }
        .sidebar-section-header {
            transition: background-color 0.2s;
        }
        .sidebar-section-header:hover {
            background-color: #f1f5f9;
        }
        .scrollbar-thin::-webkit-scrollbar {
            width: 6px;
        }
        .scrollbar-thin::-webkit-scrollbar-track {
            background: #f1f5f9;
        }
        .scrollbar-thin::-webkit-scrollbar-thumb {
            background-color: #cbd5e1;
            border-radius: 3px;
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .collapsible-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        .collapsible-content.open {
            max-height: 1000px;
        }
        
        /* Compact source tags */
        .source-tag {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            margin: 0.25rem 0.25rem 0.25rem 0;
            border-radius: 9999px; /* Fully rounded */
            font-size: 0.75rem;
            background-color: #e2e8f0;
            border: 1px solid #cbd5e1;
            color: #4a5568;
            white-space: nowrap;
        }
        
        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: white;
            border-radius: 0.5rem;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            width: 95%;
            max-width: 1000px; /* Much wider modal */
            max-height: 85vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .modal-header {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-body {
            padding: 1.5rem;
            overflow-y: auto;
            flex: 1;
        }
        
        .modal-footer {
            padding: 1rem 1.5rem;
            border-top: 1px solid #e2e8f0;
            display: flex;
            justify-content: flex-end;
            gap: 0.5rem;
        }
        
        .document-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr); /* 2 columns on mobile */
            gap: 1rem;
        }
        
        @media (min-width: 640px) {
            .document-grid {
                grid-template-columns: repeat(3, 1fr); /* 3 columns on small screens */
            }
        }
        
        @media (min-width: 768px) {
            .document-grid {
                grid-template-columns: repeat(4, 1fr); /* 4 columns on medium screens */
            }
        }
        
        @media (min-width: 1024px) {
            .document-grid {
                grid-template-columns: repeat(4, 1fr); /* 4 columns on large screens */
            }
        }
        
        .document-item {
            display: flex;
            align-items: center;
            padding: 0.75rem;
            border-radius: 0.375rem;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid #e2e8f0;
            min-height: 2.5rem;
            overflow: hidden;
        }
        
        .document-item:hover {
            background-color: #f1f5f9;
            border-color: #cbd5e1;
        }
        
        .document-item.selected {
            background-color: #dbeafe;
            border-color: #93c5fd;
        }
        
        .document-icon {
            margin-right: 0.75rem;
            width: 2.5rem;
            height: 2.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 0.25rem;
            flex-shrink: 0;
        }
        
        .pdf-icon {
            background-color: #fef2f2;
            color: #ef4444;
        }
        
        .doc-icon {
            background-color: #dbeafe;
            color: #3b82f6;
        }
        
        .xls-icon {
            background-color: #dcfce7;
            color: #22c55e;
        }
        
        .ppt-icon {
            background-color: #f0f9ff;
            color: #0ea5e9;
        }
        
        .filter-section {
            border-bottom: 1px solid #e2e8f0;
            padding-bottom: 1rem;
            margin-bottom: 1rem;
        }
        
        .filter-section h4 {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #334155;
        }
        
        .filter-options {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        
        .filter-option {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s;
            background-color: #f1f5f9;
            border: 1px solid #cbd5e1;
        }
        
        .filter-option:hover {
            background-color: #e2e8f0;
        }
        
        .filter-option.active {
            background-color: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }
        
        .document-date {
            font-size: 0.75rem;
            color: #94a3b8;
            margin-top: 0.25rem;
        }
        
        .sort-controls {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            align-items: center;
        }
        
        .sort-select {
            padding: 0.25rem 0.5rem;
            border-radius: 0.375rem;
            border: 1px solid #cbd5e1;
            background-color: white;
            font-size: 0.875rem;
            cursor: pointer;
        }
    </style>
</head>
<body class="bg-background min-h-screen">
    <div class="flex h-screen">
        <!-- Main Chat Area -->
        <div class="flex-1 flex flex-col p-6">
            <div class="mb-6">
                <h1 class="text-3xl font-bold text-gray-900 mb-2">AI Document Chat</h1>
                <p class="text-gray-600">Ask questions about your documents and get intelligent answers</p>
            </div>

            <div class="flex-1 flex flex-col bg-white rounded-xl shadow-md p-6">
                <div class="mb-4">
                    <h2 class="text-xl font-semibold text-gray-800">Document Assistant</h2>
                    <p class="text-gray-500 text-sm">Powered by RAG (Retrieval-Augmented Generation) technology</p>
                </div>

                <div class="flex-1 overflow-y-auto space-y-4 mb-4 pr-2 scrollbar-thin" style="max-height: calc(100vh - 250px);">
                    <!-- Assistant Message -->
                    <div class="flex gap-3 justify-start">
                        <div class="w-10 h-10 bg-primary rounded-full flex items-center justify-center text-white flex-shrink-0">
                            <i class="fas fa-robot"></i>
                        </div>
                        <div class="max-w-[80%]">
                            <div class="p-4 rounded-lg bg-gray-100 text-gray-900">
                                <p class="text-sm leading-relaxed">Hello! I'm your AI document assistant. I can help you find information, answer questions, and analyze content from your uploaded documents. What would you like to know?</p>
                            </div>
                        </div>
                    </div>

                    <!-- User Message -->
                    <div class="flex gap-3 justify-end">
                        <div class="max-w-[80%]">
                            <div class="p-4 rounded-lg bg-primary text-white">
                                <p class="text-sm leading-relaxed">Can you summarize the key points from the Q4 financial report?</p>
                            </div>
                        </div>
                        <div class="w-10 h-10 bg-gray-500 rounded-full flex items-center justify-center text-white flex-shrink-0">
                            <i class="fas fa-user"></i>
                        </div>
                    </div>

                    <!-- Assistant Response with Sources -->
                    <div class="flex gap-3 justify-start">
                        <div class="w-10 h-10 bg-primary rounded-full flex items-center justify-center text-white flex-shrink-0">
                            <i class="fas fa-robot"></i>
                        </div>
                        <div class="max-w-[80%]">
                            <div class="p-4 rounded-lg bg-gray-100 text-gray-900">
                                <p class="text-sm leading-relaxed">Based on your documents, I found relevant information about financial performance. The Q4 report shows a 15% increase in revenue year-over-year, with strong growth in the technology sector. The market analysis indicates positive trends in consumer behavior and emerging technologies.</p>
                            </div>
                            
                            <div class="mt-2">
                                <p class="text-xs text-gray-500 font-medium">Sources:</p>
                                <div class="flex flex-wrap gap-1 mt-1">
                                    <div class="source-tag">
                                        Financial Report Q4.pdf
                                    </div>
                                    <div class="source-tag">
                                        Market Analysis.pdf
                                    </div>
                                </div>
                            </div>
                            
                            <div class="flex items-center gap-2 mt-3">
                                <button class="btn btn-sm btn-outline border-gray-300 text-gray-500 hover:bg-gray-100">
                                    <i class="far fa-copy"></i>
                                </button>
                                <button class="btn btn-sm btn-outline border-gray-300 text-gray-500 hover:bg-gray-100">
                                    <i class="far fa-thumbs-up"></i>
                                </button>
                                <button class="btn btn-sm btn-outline border-gray-300 text-gray-500 hover:bg-gray-100">
                                    <i class="far fa-thumbs-down"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Typing Indicator -->
                    <div class="flex gap-3">
                        <div class="w-10 h-10 bg-primary rounded-full flex items-center justify-center text-white flex-shrink-0">
                            <i class="fas fa-robot"></i>
                        </div>
                        <div class="bg-gray-100 p-4 rounded-lg">
                            <div class="flex gap-1">
                                <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce"></div>
                                <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0.1s;"></div>
                                <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0.2s;"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Input Area -->
                <div class="flex gap-2">
                    <input 
                        type="text" 
                        placeholder="Ask a question about your documents..." 
                        class="flex-1 border border-gray-300 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
                    >
                    <button class="bg-primary hover:bg-blue-600 text-white rounded-lg px-5 py-3 transition duration-200 flex items-center">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Improved Sidebar -->
        <div class="w-96 bg-sidebar border-l border-gray-200 flex flex-col">
            <!-- Sidebar Header -->
            <div class="p-4 border-b border-gray-200">
                <h2 class="text-lg font-semibold text-gray-800">Assistant Panel</h2>
                <p class="text-xs text-gray-500">Document insights and controls</p>
            </div>

            <!-- Sidebar Content -->
            <div class="flex-1 overflow-y-auto scrollbar-thin">
                <!-- Sources Section -->
                <div class="sidebar-section border-b border-gray-200">
                    <div class="sidebar-section-header p-4 flex items-center justify-between cursor-pointer">
                        <div class="flex items-center">
                            <i class="fas fa-book text-primary mr-2"></i>
                            <div>
                                <h3 class="font-medium text-gray-800">Sources</h3>
                                <p class="text-xs text-gray-500">Documents used for responses</p>
                            </div>
                        </div>
                        <i class="fas fa-chevron-down text-gray-400 transition-transform duration-200 transform"></i>
                    </div>
                    <div class="collapsible-content">
                        <div class="px-4 pb-4 space-y-3">
                            <div class="p-3 bg-blue-50 rounded-lg border border-blue-200">
                                <div class="flex items-center gap-2 mb-2">
                                    <i class="fas fa-file-pdf text-red-500"></i>
                                    <p class="font-medium text-sm truncate">Financial Report Q4.pdf</p>
                                    <span class="text-xs bg-green-100 text-green-800 px-2 py-0.5 rounded-full">95%</span>
                                </div>
                                <p class="text-xs text-gray-600">Quarterly financial summary with revenue analysis</p>
                            </div>
                            <div class="p-3 bg-blue-50 rounded-lg border border-blue-200">
                                <div class="flex items-center gap-2 mb-2">
                                    <i class="fas fa-file-pdf text-red-500"></i>
                                    <p class="font-medium text-sm truncate">Market Analysis.pdf</p>
                                    <span class="text-xs bg-green-100 text-green-800 px-2 py-0.5 rounded-full">88%</span>
                                </div>
                                <p class="text-xs text-gray-600">Consumer trends and market predictions</p>
                            </div>
                            <div class="p-3 bg-blue-50 rounded-lg border border-blue-200">
                                <div class="flex items-center gap-2 mb-2">
                                    <i class="fas fa-file-word text-blue-500"></i>
                                    <p class="font-medium text-sm truncate">Product Roadmap.docx</p>
                                    <span class="text-xs bg-green-100 text-green-800 px-2 py-0.5 rounded-full">76%</span>
                                </div>
                                <p class="text-xs text-gray-600">Upcoming product features and timelines</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Chat History Section -->
                <div class="sidebar-section border-b border-gray-200">
                    <div class="sidebar-section-header p-4 flex items-center justify-between cursor-pointer">
                        <div class="flex items-center">
                            <i class="fas fa-history text-primary mr-2"></i>
                            <div>
                                <h3 class="font-medium text-gray-800">Chat History</h3>
                                <p class="text-xs text-gray-500">Previous conversations</p>
                            </div>
                        </div>
                        <i class="fas fa-chevron-down text-gray-400 transition-transform duration-200 transform"></i>
                    </div>
                    <div class="collapsible-content">
                        <div class="px-4 pb-4 space-y-2">
                            <div class="p-3 bg-gray-50 rounded-lg border border-gray-200 hover:bg-gray-100 transition-colors cursor-pointer">
                                <div class="flex items-center gap-2">
                                    <i class="fas fa-comment text-gray-500"></i>
                                    <p class="font-medium text-sm truncate">Q4 Financial Analysis</p>
                                </div>
                                <p class="text-xs text-gray-500 mt-1">Yesterday, 3:42 PM</p>
                            </div>
                            <div class="p-3 bg-gray-50 rounded-lg border border-gray-200 hover:bg-gray-100 transition-colors cursor-pointer">
                                <div class="flex items-center gap-2">
                                    <i class="fas fa-comment text-gray-500"></i>
                                    <p class="font-medium text-sm truncate">Market Trends Discussion</p>
                                </div>
                                <p class="text-xs text-gray-500 mt-1">Oct 12, 2023</p>
                            </div>
                            <div class="p-3 bg-gray-50 rounded-lg border border-gray-200 hover:bg-gray-100 transition-colors cursor-pointer">
                                <div class="flex items-center gap-2">
                                    <i class="fas fa-comment text-gray-500"></i>
                                    <p class="font-medium text-sm truncate">Product Roadmap Review</p>
                                </div>
                                <p class="text-xs text-gray-500 mt-1">Oct 10, 2023</p>
                            </div>
                            <div class="p-3 bg-gray-50 rounded-lg border border-gray-200 hover:bg-gray-100 transition-colors cursor-pointer">
                                <div class="flex items-center gap-2">
                                    <i class="fas fa-comment text-gray-500"></i>
                                    <p class="font-medium text-sm truncate">Competitor Analysis</p>
                                </div>
                                <p class="text-xs text-gray-500 mt-1">Oct 5, 2023</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Knowledge Base Section -->
                <div class="sidebar-section">
                    <div class="sidebar-section-header p-4 flex items-center justify-between cursor-pointer" id="knowledgeBaseHeader">
                        <div class="flex items-center">
                            <i class="fas fa-database text-primary mr-2"></i>
                            <div>
                                <h3 class="font-medium text-gray-800">Knowledge Base</h3>
                                <p class="text-xs text-gray-500">Manage document sources</p>
                            </div>
                        </div>
                        <i class="fas fa-chevron-down text-gray-400 transition-transform duration-200 transform"></i>
                    </div>
                    <div class="collapsible-content">
                        <div class="px-4 pb-4">
                            <div class="text-center py-4">
                                <button id="selectDocumentsBtn" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg text-sm transition-colors">
                                    <i class="fas fa-plus mr-1"></i> Select Documents
                                </button>
                            </div>
                            <div id="selectedDocumentsContainer" class="flex flex-wrap gap-1 mt-2">
                                <!-- Selected documents will appear here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sidebar Footer -->
            <div class="p-4 border-t border-gray-200 text-center">
                <button class="text-sm text-gray-500 hover:text-gray-700 flex items-center justify-center mx-auto">
                    <i class="fas fa-cog mr-1"></i> Settings
                </button>
            </div>
        </div>
    </div>

    <!-- Document Selection Modal -->
    <div id="documentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="text-lg font-semibold text-gray-800">Select Documents</h3>
                <button id="closeModalBtn" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <!-- Filter Section -->
                <div class="filter-section">
                    <div class="flex justify-between items-center mb-3">
                        <h4 class="mb-0">Filter by Type</h4>
                        <div class="flex gap-2 items-center">
                            <div class="sort-controls">
                                <select id="sortDateSelect" class="sort-select">
                                    <option value="none">None</option>
                                    <option value="date-desc">Date (Newest First)</option>
                                    <option value="date-asc">Date (Oldest First)</option>
                                </select>
                            </div>
                            <div class="sort-controls">
                                <select id="sortSizeSelect" class="sort-select">
                                    <option value="none">None</option>
                                    <option value="size-desc">Size (Largest First)</option>
                                    <option value="size-asc">Size (Smallest First)</option>
                                </select>
                            </div>
                            <button id="deselectAllBtn" class="text-sm text-gray-500 hover:text-gray-700">
                                <i class="fas fa-times-circle mr-1"></i> Deselect All
                            </button>
                        </div>
                    </div>
                    <div class="filter-options">
                        <div class="filter-option active" data-type="all">All</div>
                        <div class="filter-option" data-type="pdf">PDF</div>
                        <div class="filter-option" data-type="doc">Word</div>
                        <div class="filter-option" data-type="xls">Excel</div>
                        <div class="filter-option" data-type="ppt">PowerPoint</div>
                    </div>
                </div>
                
                <!-- Search and Document List -->
                <div class="mb-4">
                    <input type="text" id="searchDocuments" placeholder="Search documents..." class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div id="documentsList" class="document-grid">
                    <!-- Document items will be populated here in a grid -->
                </div>
            </div>
            <div class="modal-footer">
                <button id="cancelModalBtn" class="px-4 py-2 text-gray-700 hover:bg-gray-100 rounded-lg transition-colors">Cancel</button>
                <button id="saveDocumentsBtn" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors">Done</button>
            </div>
        </div>
    </div>

    <script>
        // Sample document data - expanded to show more documents with dates
        const documents = [
            { id: 1, name: "Financial Report Q4.pdf", type: "pdf", size: "2.4 MB", date: "2023-10-15" },
            { id: 2, name: "Market Analysis.pdf", type: "pdf", size: "1.8 MB", date: "2023-09-22" },
            { id: 3, name: "Product Roadmap.docx", type: "doc", size: "1.1 MB", date: "2023-11-05" },
            { id: 4, name: "Sales Data Q4.xlsx", type: "xls", size: "3.2 MB", date: "2023-10-30" },
            { id: 5, name: "Presentation.pptx", type: "ppt", size: "5.7 MB", date: "2023-11-10" },
            { id: 6, name: "User Research.pdf", type: "pdf", size: "4.3 MB", date: "2023-08-17" },
            { id: 7, name: "Competitor Analysis.docx", type: "doc", size: "2.1 MB", date: "2023-09-05" },
            { id: 8, name: "Technical Specifications.pdf", type: "pdf", size: "3.5 MB", date: "2023-10-12" },
            { id: 9, name: "Marketing Plan.docx", type: "doc", size: "1.9 MB", date: "2023-11-01" },
            { id: 10, name: "Budget Proposal.xlsx", type: "xls", size: "0.8 MB", date: "2023-10-25" },
            { id: 11, name: "Customer Feedback.pdf", type: "pdf", size: "2.7 MB", date: "2023-09-18" },
            { id: 12, name: "Project Timeline.pptx", type: "ppt", size: "4.1 MB", date: "2023-11-08" },
            { id: 13, name: "Annual Report 2023.pdf", type: "pdf", size: "6.2 MB", date: "2023-12-01" },
            { id: 14, name: "Employee Handbook.docx", type: "doc", size: "3.4 MB", date: "2023-07-20" },
            { id: 15, name: "Inventory List.xlsx", type: "xls", size: "1.5 MB", date: "2023-11-15" },
            { id: 16, name: "Training Materials.pptx", type: "ppt", size: "7.8 MB", date: "2023-10-05" },
            { id: 17, name: "Security Policy.pdf", type: "pdf", size: "0.9 MB", date: "2023-08-30" },
            { id: 18, name: "Vendor Contracts.docx", type: "doc", size: "4.6 MB", date: "2023-09-12" },
            { id: 19, name: "Performance Metrics.xlsx", type: "xls", size: "2.3 MB", date: "2023-11-20" },
            { id: 20, name: "Product Catalog.pptx", type: "ppt", size: "8.1 MB", date: "2023-10-18" },
            { id: 21, name: "Legal Compliance.pdf", type: "pdf", size: "3.7 MB", date: "2023-07-25" },
            { id: 22, name: "IT Infrastructure.docx", type: "doc", size: "5.2 MB", date: "2023-11-02" },
            { id: 23, name: "Sales Forecast.xlsx", type: "xls", size: "1.8 MB", date: "2023-11-12" },
            { id: 24, name: "Brand Guidelines.pptx", type: "ppt", size: "6.5 MB", date: "2023-09-28" },
            { id: 25, name: "Research Paper.pdf", type: "pdf", size: "4.9 MB", date: "2023-08-05" },
            { id: 26, name: "Meeting Minutes.docx", type: "doc", size: "0.5 MB", date: "2023-11-07" },
            { id: 27, name: "Expense Report.xlsx", type: "xls", size: "0.3 MB", date: "2023-11-14" },
            { id: 28, name: "Product Demo.pptx", type: "ppt", size: "9.2 MB", date: "2023-10-22" },
            { id: 29, name: "Privacy Policy.pdf", type: "pdf", size: "1.1 MB", date: "2023-07-30" },
            { id: 30, name: "Project Plan.docx", type: "doc", size: "2.8 MB", date: "2023-11-03" },
            { id: 31, name: "Resource Allocation.xlsx", type: "xls", size: "1.4 MB", date: "2023-11-16" },
            { id: 32, name: "Company Overview.pptx", type: "ppt", size: "5.6 MB", date: "2023-09-15" }
        ];

        // Selected documents array
        let selectedDocuments = [];

        // DOM Elements
        const knowledgeBaseHeader = document.getElementById('knowledgeBaseHeader');
        const selectDocumentsBtn = document.getElementById('selectDocumentsBtn');
        const documentModal = document.getElementById('documentModal');
        const closeModalBtn = document.getElementById('closeModalBtn');
        const cancelModalBtn = document.getElementById('cancelModalBtn');
        const saveDocumentsBtn = document.getElementById('saveDocumentsBtn');
        const documentsList = document.getElementById('documentsList');
        const selectedDocumentsContainer = document.getElementById('selectedDocumentsContainer');
        const searchInput = document.getElementById('searchDocuments');
        const deselectAllBtn = document.getElementById('deselectAllBtn');
        const filterOptions = document.querySelectorAll('.filter-option');
        const sortDateSelect = document.getElementById('sortDateSelect');
        const sortSizeSelect = document.getElementById('sortSizeSelect');

        // Current filter state
        let currentFilter = 'all';
        let currentSearch = '';
        let currentSortDate = 'none';
        let currentSortSize = 'none';

        // Toggle sidebar sections
        document.querySelectorAll('.sidebar-section-header').forEach(header => {
            header.addEventListener('click', () => {
                const section = header.parentElement;
                const icon = header.querySelector('i');
                const content = section.querySelector('.collapsible-content');
                
                // Toggle the content
                content.classList.toggle('open');
                
                // Rotate the icon
                if (content.classList.contains('open')) {
                    icon.classList.remove('fa-chevron-down');
                    icon.classList.add('fa-chevron-up');
                } else {
                    icon.classList.remove('fa-chevron-up');
                    icon.classList.add('fa-chevron-down');
                }
            });
        });

        // Open document selection modal
        selectDocumentsBtn.addEventListener('click', () => {
            documentModal.style.display = 'flex';
            renderDocumentsList();
        });

        // Close modal functions
        function closeModal() {
            documentModal.style.display = 'none';
        }

        closeModalBtn.addEventListener('click', closeModal);
        cancelModalBtn.addEventListener('click', closeModal);

        // Close modal when clicking outside
        window.addEventListener('click', (e) => {
            if (e.target === documentModal) {
                closeModal();
            }
        });

        // Save selected documents
        saveDocumentsBtn.addEventListener('click', () => {
            renderSelectedDocuments();
            closeModal();
        });

        // Deselect all documents
        deselectAllBtn.addEventListener('click', () => {
            selectedDocuments = [];
            renderDocumentsList();
        });

        // Filter by document type
        filterOptions.forEach(option => {
            option.addEventListener('click', () => {
                // Update active state
                filterOptions.forEach(opt => opt.classList.remove('active'));
                option.classList.add('active');
                
                // Update filter
                currentFilter = option.dataset.type;
                
                // Re-render documents
                renderDocumentsList();
            });
        });

        // Sort by date
        sortDateSelect.addEventListener('change', () => {
            currentSortDate = sortDateSelect.value;
            renderDocumentsList();
        });

        // Sort by size
        sortSizeSelect.addEventListener('change', () => {
            currentSortSize = sortSizeSelect.value;
            renderDocumentsList();
        });

        // Search functionality
        searchInput.addEventListener('input', (e) => {
            currentSearch = e.target.value.toLowerCase();
            renderDocumentsList();
        });

        // Format date for display
        function formatDate(dateString) {
            const options = { year: 'numeric', month: 'short', day: 'numeric' };
            return new Date(dateString).toLocaleDateString(undefined, options);
        }

        // Convert size string to bytes for sorting
        function sizeToBytes(sizeStr) {
            const units = { 'B': 1, 'KB': 1024, 'MB': 1024 * 1024, 'GB': 1024 * 1024 * 1024 };
            const match = sizeStr.match(/(\d+(?:\.\d+)?)\s*(B|KB|MB|GB)/i);
            if (!match) return 0;
            const value = parseFloat(match[1]);
            const unit = match[2].toUpperCase();
            return value * (units[unit] || 1);
        }

        // Render documents list in modal
        function renderDocumentsList() {
            documentsList.innerHTML = '';
            
            // Filter documents based on search and type
            let filteredDocuments = documents.filter(doc => {
                // Type filter
                if (currentFilter !== 'all' && doc.type !== currentFilter) {
                    return false;
                }
                
                // Search filter
                if (currentSearch && !doc.name.toLowerCase().includes(currentSearch)) {
                    return false;
                }
                
                return true;
            });
            
            // Sort documents
            filteredDocuments.sort((a, b) => {
                // If no sorting is applied for date, don't sort by date
                if (currentSortDate === 'none') {
                    // If no sorting is applied for size, don't sort by size
                    if (currentSortSize === 'none') {
                        return 0; // No sorting
                    }
                    
                    // Only sort by size if date sorting is disabled
                    if (currentSortSize === 'size-desc') {
                        return sizeToBytes(b.size) - sizeToBytes(a.size);
                    } else if (currentSortSize === 'size-asc') {
                        return sizeToBytes(a.size) - sizeToBytes(b.size);
                    }
                }
                
                // Sort by date first
                if (currentSortDate === 'date-desc') {
                    return new Date(b.date) - new Date(a.date);
                } else if (currentSortDate === 'date-asc') {
                    return new Date(a.date) - new Date(b.date);
                }
                
                // Then sort by size
                if (currentSortSize === 'size-desc') {
                    return sizeToBytes(b.size) - sizeToBytes(a.size);
                } else if (currentSortSize === 'size-asc') {
                    return sizeToBytes(a.size) - sizeToBytes(b.size);
                }
                
                return 0;
            });
            
            if (filteredDocuments.length === 0) {
                documentsList.innerHTML = '<p class="text-gray-500 text-center col-span-full py-4">No documents found</p>';
                return;
            }
            
            filteredDocuments.forEach(doc => {
                const docItem = document.createElement('div');
                docItem.className = `document-item ${selectedDocuments.includes(doc.id) ? 'selected' : ''}`;
                docItem.dataset.id = doc.id;
                
                // Determine icon based on file type
                let iconClass, iconBg, iconColor;
                switch(doc.type) {
                    case 'pdf':
                        iconClass = 'fa-file-pdf';
                        iconBg = 'pdf-icon';
                        iconColor = 'text-red-500';
                        break;
                    case 'doc':
                    case 'docx':
                        iconClass = 'fa-file-word';
                        iconBg = 'doc-icon';
                        iconColor = 'text-blue-500';
                        break;
                    case 'xls':
                    case 'xlsx':
                        iconClass = 'fa-file-excel';
                        iconBg = 'xls-icon';
                        iconColor = 'text-green-500';
                        break;
                    case 'ppt':
                    case 'pptx':
                        iconClass = 'fa-file-powerpoint';
                        iconBg = 'ppt-icon';
                        iconColor = 'text-sky-500';
                        break;
                    default:
                        iconClass = 'fa-file';
                        iconBg = 'bg-gray-100';
                        iconColor = 'text-gray-500';
                }
                
                docItem.innerHTML = `
                    <div class="document-icon ${iconBg} ${iconColor}">
                        <i class="fas ${iconClass} text-lg"></i>
                    </div>
                    <div class="flex-1 min-w-0">
                        <p class="font-medium text-sm truncate">${doc.name}</p>
                        <p class="text-xs text-gray-500 mt-1">${doc.size}</p>
                        <p class="document-date">${formatDate(doc.date)}</p>
                    </div>
                    <div>
                        <i class="fas fa-check text-blue-500 text-lg ${selectedDocuments.includes(doc.id) ? '' : 'opacity-0'}"></i>
                    </div>
                `;
                
                docItem.addEventListener('click', () => {
                    const docId = parseInt(docItem.dataset.id);
                    const index = selectedDocuments.indexOf(docId);
                    
                    if (index === -1) {
                        selectedDocuments.push(docId);
                    } else {
                        selectedDocuments.splice(index, 1);
                    }
                    
                    renderDocumentsList();
                });
                
                documentsList.appendChild(docItem);
            });
        }

        // Render selected documents in knowledge base
        function renderSelectedDocuments() {
            selectedDocumentsContainer.innerHTML = '';
            
            if (selectedDocuments.length === 0) {
                selectedDocumentsContainer.innerHTML = '<p class="text-xs text-gray-500 w-full text-center">No documents selected</p>';
                return;
            }
            
            selectedDocuments.forEach(docId => {
                const doc = documents.find(d => d.id === docId);
                if (doc) {
                    const tag = document.createElement('div');
                    tag.className = 'source-tag';
                    tag.innerHTML = `
                        ${doc.name}
                        <button class="ml-1 text-gray-500 hover:text-gray-700 remove-doc" data-id="${docId}">
                            <i class="fas fa-times text-xs"></i>
                        </button>
                    `;
                    
                    selectedDocumentsContainer.appendChild(tag);
                }
            });
            
            // Add event listeners to remove buttons
            document.querySelectorAll('.remove-doc').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const docId = parseInt(btn.dataset.id);
                    selectedDocuments = selectedDocuments.filter(id => id !== docId);
                    renderSelectedDocuments();
                });
            });
        }

        // Initialize sections (first one open by default)
        document.addEventListener('DOMContentLoaded', () => {
            const sections = document.querySelectorAll('.sidebar-section');
            sections.forEach((section, index) => {
                const content = section.querySelector('.collapsible-content');
                const icon = section.querySelector('.sidebar-section-header i');
                
                if (index === 0) {
                    content.classList.add('open');
                    icon.classList.remove('fa-chevron-down');
                    icon.classList.add('fa-chevron-up');
                }
            });
            
            // Render initial selected documents
            renderSelectedDocuments();
        });
    </script>
</body>
</html>